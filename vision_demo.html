<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickFlip AI - Vision API Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .demo-section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .demo-section h2 {
            color: #3498db;
            margin-bottom: 20px;
        }
        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f0f8ff;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            background: #e6f3ff;
            border-color: #2980b9;
        }
        .upload-area.dragover {
            background: #d4edda;
            border-color: #28a745;
        }
        .file-input {
            display: none;
        }
        .upload-text {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        .upload-hint {
            color: #7f8c8d;
            font-size: 14px;
        }
        .image-preview {
            display: none;
            margin: 20px 0;
            text-align: center;
        }
        .image-preview img {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .analyze-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s;
        }
        .analyze-btn:hover {
            background: #219a52;
        }
        .analyze-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid #27ae60;
            margin-top: 20px;
            display: none;
        }
        .results.show {
            display: block;
        }
        .loading {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }
        .result-section {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .result-section h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        .label-item {
            background: #ecf0f1;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 6px;
            display: inline-block;
            font-size: 14px;
        }
        .label-item.car-related {
            background: #d5f4e6;
            color: #27ae60;
            font-weight: bold;
        }
        .confidence-high {
            background: #d5f4e6;
            color: #27ae60;
        }
        .confidence-medium {
            background: #fff3cd;
            color: #856404;
        }
        .confidence-low {
            background: #f8d7da;
            color: #721c24;
        }
        .text-found {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 6px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 13px;
        }
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-connected {
            background: #27ae60;
        }
        .status-error {
            background: #e74c3c;
        }
        .error {
            color: #e74c3c;
            background: #fadbd8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .sample-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .sample-image {
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            transition: border-color 0.3s;
        }
        .sample-image:hover {
            border-color: #3498db;
        }
        .sample-image img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }
        .sample-image .sample-label {
            padding: 8px;
            background: #f8f9fa;
            text-align: center;
            font-size: 12px;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç QuickFlip AI - Vision API Demo</h1>
        
        <div class="demo-section">
            <h2><span class="status-indicator status-connected"></span>Google Vision API Status: Ready ‚úÖ</h2>
            <p>Upload car images to see AI-powered analysis in action! The Vision API will detect car types, condition, text (VIN, mileage), and more.</p>
        </div>

        <div class="demo-section">
            <h2>üì∏ Upload Car Image for Analysis</h2>
            
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-text">üì∑ Click to upload or drag & drop a car image</div>
                <div class="upload-hint">Supports JPG, PNG, GIF ‚Ä¢ Max 10MB ‚Ä¢ Best results with clear car photos</div>
            </div>
            
            <input type="file" id="fileInput" class="file-input" accept="image/*" onchange="handleFileSelect(event)">
            
            <div id="imagePreview" class="image-preview">
                <img id="previewImg" alt="Preview">
                <div>
                    <button class="analyze-btn" onclick="analyzeImage()">üîç Analyze with Vision API</button>
                    <button class="analyze-btn" onclick="clearImage()" style="background: #e74c3c;">üóëÔ∏è Clear</button>
                </div>
            </div>

            <div id="results" class="results">
                <div id="loading" class="loading">
                    ü§ñ Vision API is analyzing your image... This may take a few seconds.
                </div>
                <div id="analysisResults"></div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üöó Sample Car Images (Click to Test)</h2>
            <p>Don't have a car image? Try these samples to see the Vision API in action:</p>
            
            <div class="sample-images">
                <div class="sample-image" onclick="loadSampleImage('sedan')">
                    <div style="background: linear-gradient(45deg, #ff6b6b, #ee5a6f); height: 100px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">üöó</div>
                    <div class="sample-label">Sedan</div>
                </div>
                <div class="sample-image" onclick="loadSampleImage('suv')">
                    <div style="background: linear-gradient(45deg, #4ecdc4, #44a08d); height: 100px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">üöô</div>
                    <div class="sample-label">SUV</div>
                </div>
                <div class="sample-image" onclick="loadSampleImage('truck')">
                    <div style="background: linear-gradient(45deg, #45b7d1, #96c93d); height: 100px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">üöö</div>
                    <div class="sample-label">Truck</div>
                </div>
                <div class="sample-image" onclick="loadSampleImage('sports')">
                    <div style="background: linear-gradient(45deg, #f093fb, #f5576c); height: 100px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">üèéÔ∏è</div>
                    <div class="sample-label">Sports Car</div>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üìä Recent Vision API Results</h2>
            <div id="recentResults">
                <div class="label-item">Waiting for first analysis...</div>
            </div>
        </div>
    </div>

    <script>
        let currentImageData = null;
        let recentAnalyses = [];

        // File upload handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                displayImagePreview(file);
            }
        }

        // Drag and drop handling
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                displayImagePreview(files[0]);
            }
        });

        function displayImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('imagePreview').style.display = 'block';
                currentImageData = file;
            };
            reader.readAsDataURL(file);
        }

        function clearImage() {
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('results').classList.remove('show');
            document.getElementById('fileInput').value = '';
            currentImageData = null;
        }

        async function analyzeImage() {
            if (!currentImageData) {
                alert('Please select an image first!');
                return;
            }

            const results = document.getElementById('results');
            const loading = document.getElementById('loading');
            const analysisResults = document.getElementById('analysisResults');
            const analyzeBtn = document.querySelector('.analyze-btn');
            
            // Show loading
            results.classList.add('show');
            loading.style.display = 'block';
            analysisResults.innerHTML = '';
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'üîç Analyzing...';
            
            try {
                // Create FormData for image upload
                const formData = new FormData();
                formData.append('image', currentImageData);
                
                // Call your Vision API endpoint
                const response = await fetch('http://localhost:8000/api/v1/vision/analyze-image', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                loading.style.display = 'none';
                
                if (result.success) {
                    displayVisionResults(result);
                    addToRecentResults(result);
                } else {
                    analysisResults.innerHTML = `<div class="error">Analysis failed: ${result.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                analysisResults.innerHTML = `
                    <div class="error">
                        <strong>Connection Error:</strong> ${error.message}<br><br>
                        Make sure your QuickFlip AI backend is running on port 8000 and the Vision API endpoint is available.
                        <br><br>
                        <strong>Expected endpoint:</strong> POST /api/v1/vision/analyze-image
                    </div>
                `;
            }
            
            analyzeBtn.disabled = false;
            analyzeBtn.textContent = 'üîç Analyze with Vision API';
        }

        function displayVisionResults(result) {
            const data = result;
            let html = `<h3>üéØ Vision API Analysis Results</h3>`;
            
            // Summary
            const summary = data.summary;
            html += `
                <div class="result-section">
                    <h4>üìä Analysis Summary</h4>
                    <div class="label-item confidence-${summary.analysis_quality}">
                        Quality: ${summary.analysis_quality.toUpperCase()}
                    </div>
                    <div class="label-item">Labels: ${summary.total_labels}</div>
                    <div class="label-item">Car-related: ${summary.car_related_labels}</div>
                    <div class="label-item">Text elements: ${summary.text_elements}</div>
                </div>
            `;
            
            // Car Detection
            if (data.make_model_detected && data.make_model_detected.primary_type !== 'Unknown') {
                html += `
                    <div class="result-section">
                        <h4>üöó Vehicle Detection</h4>
                        <div class="label-item car-related">
                            ${data.make_model_detected.primary_type} 
                            (${(data.make_model_detected.confidence * 100).toFixed(1)}% confidence)
                        </div>
                `;
                
                if (data.make_model_detected.labels && data.make_model_detected.labels.length > 1) {
                    html += '<div style="margin-top: 10px;">Other detections:</div>';
                    for (let i = 1; i < Math.min(4, data.make_model_detected.labels.length); i++) {
                        const label = data.make_model_detected.labels[i];
                        html += `<div class="label-item">${label.description} (${label.confidence_percent}%)</div>`;
                    }
                }
                html += '</div>';
            }
            
            // Condition Assessment
            if (data.condition_assessment) {
                const condition = data.condition_assessment.overall_condition;
                html += `
                    <div class="result-section">
                        <h4>üîç Condition Assessment</h4>
                        <div class="label-item confidence-${condition === 'excellent' ? 'high' : condition === 'poor' ? 'low' : 'medium'}">
                            Overall: ${condition.toUpperCase()}
                        </div>
                `;
                
                if (data.condition_assessment.damage_indicators && data.condition_assessment.damage_indicators.length > 0) {
                    html += '<div style="margin-top: 10px;">‚ö†Ô∏è Damage indicators:</div>';
                    data.condition_assessment.damage_indicators.forEach(damage => {
                        html += `<div class="label-item confidence-low">${damage.description}</div>`;
                    });
                }
                html += '</div>';
            }
            
            // Text Extraction
            if (data.text_extracted) {
                const textData = data.text_extracted;
                if (textData.vin_candidates.length > 0 || textData.year_candidates.length > 0 || textData.mileage_candidates.length > 0) {
                    html += `
                        <div class="result-section">
                            <h4>üìù Text Extracted</h4>
                    `;
                    
                    if (textData.vin_candidates.length > 0) {
                        html += `<div><strong>VIN:</strong> <div class="text-found">${textData.vin_candidates[0]}</div></div>`;
                    }
                    
                    if (textData.year_candidates.length > 0) {
                        html += `<div><strong>Year:</strong> <span class="label-item">${textData.year_candidates[0]}</span></div>`;
                    }
                    
                    if (textData.mileage_candidates.length > 0) {
                        const mileage = textData.mileage_candidates[0];
                        html += `<div><strong>Mileage:</strong> <span class="label-item">${mileage.value} (from: "${mileage.text}")</span></div>`;
                    }
                    
                    if (textData.other_text.length > 0) {
                        html += '<div><strong>Other text:</strong></div>';
                        textData.other_text.slice(0, 3).forEach(text => {
                            html += `<div class="text-found">${text}</div>`;
                        });
                    }
                    
                    html += '</div>';
                }
            }
            
            // Confidence Scores
            if (data.confidence_scores) {
                html += `
                    <div class="result-section">
                        <h4>üìà Confidence Scores</h4>
                        <div class="label-item confidence-${data.confidence_scores.overall > 0.7 ? 'high' : data.confidence_scores.overall > 0.4 ? 'medium' : 'low'}">
                            Overall: ${(data.confidence_scores.overall * 100).toFixed(1)}%
                        </div>
                        <div class="label-item confidence-${data.confidence_scores.make_model > 0.7 ? 'high' : data.confidence_scores.make_model > 0.4 ? 'medium' : 'low'}">
                            Car Detection: ${(data.confidence_scores.make_model * 100).toFixed(1)}%
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('analysisResults').innerHTML = html;
        }

        function addToRecentResults(result) {
            const carType = result.make_model_detected?.primary_type || 'Unknown';
            const confidence = result.confidence_scores?.overall || 0;
            const condition = result.condition_assessment?.overall_condition || 'unknown';
            
            recentAnalyses.unshift({
                carType,
                confidence: (confidence * 100).toFixed(1),
                condition,
                timestamp: new Date().toLocaleTimeString()
            });
            
            // Keep only last 5 results
            recentAnalyses = recentAnalyses.slice(0, 5);
            
            updateRecentResults();
        }

        function updateRecentResults() {
            const container = document.getElementById('recentResults');
            if (recentAnalyses.length === 0) {
                container.innerHTML = '<div class="label-item">Waiting for first analysis...</div>';
                return;
            }
            
            let html = '';
            recentAnalyses.forEach(analysis => {
                const confidenceClass = analysis.confidence > 70 ? 'confidence-high' : analysis.confidence > 40 ? 'confidence-medium' : 'confidence-low';
                html += `
                    <div class="label-item ${confidenceClass}">
                        ${analysis.carType} ‚Ä¢ ${analysis.confidence}% ‚Ä¢ ${analysis.condition} ‚Ä¢ ${analysis.timestamp}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function loadSampleImage(type) {
            // Create a simple colored rectangle as a sample image
            const canvas = document.createElement('canvas');
            canvas.width = 400;
            canvas.height = 300;
            const ctx = canvas.getContext('2d');
            
            // Different colors for different car types
            const colors = {
                sedan: ['#ff6b6b', '#ee5a6f'],
                suv: ['#4ecdc4', '#44a08d'],
                truck: ['#45b7d1', '#96c93d'],
                sports: ['#f093fb', '#f5576c']
            };
            
            const gradient = ctx.createLinearGradient(0, 0, 400, 300);
            gradient.addColorStop(0, colors[type][0]);
            gradient.addColorStop(1, colors[type][1]);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 400, 300);
            
            // Add car emoji
            ctx.font = '80px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = 'white';
            const emoji = type === 'sedan' ? 'üöó' : type === 'suv' ? 'üöô' : type === 'truck' ? 'üöö' : 'üèéÔ∏è';
            ctx.fillText(emoji, 200, 180);
            
            // Add text
            ctx.font = '24px Arial';
            ctx.fillText(`Sample ${type.toUpperCase()}`, 200, 240);
            ctx.fillText('2020 ‚Ä¢ 50,000 miles', 200, 270);
            
            // Convert to blob and use as sample image
            canvas.toBlob(blob => {
                const file = new File([blob], `sample_${type}.png`, { type: 'image/png' });
                displayImagePreview(file);
            });
        }

        // Auto-scroll to results when they appear
        const observer = new MutationObserver(() => {
            const results = document.getElementById('results');
            if (results.classList.contains('show')) {
                results.scrollIntoView({ behavior: 'smooth' });
            }
        });
        observer.observe(document.getElementById('results'), { attributes: true });
    </script>
</body>
</html> 